apiVersion: scone/5.8
kind: genservice

# define environment variables
#  - local ones are only visible for this service
#  - global ones are defined for all services in a mesh

environment:
  local:
    - name: SCONE_HEAP
      value: 760M
    - name: SCONE_LOG
      value: error
  global:     # values defined/overwritten in Meshfile
    - name: REDIS_HOST  # get value from Meshfile

# define secrets that are managed by CAS 
secrets:
  import:
    - redis_client_cert-key
    - redis_ca_cert
  global:
    - name: api_ca_key
      kind: private-key
    - name: api_ca_cert
      kind: x509-ca
      private_key: api_ca_key
    - name: flask_key
      kind: private-key
    - name: flask
      kind: x509
      private_key: flask_key
      issuer: api_ca_cert
      dns:
        - api

build:
  name: python-hello-user
  kind: python
  to: registry.scontain.com:5050/cicd/python_hello_user:latest
  pwd: /python
  requirements: requirments.txt
  command: python3 api.py
  copy:
    - api.py
